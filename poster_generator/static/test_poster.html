<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Poster Generator - Test UI</title>
    <style>
      body { font-family: system-ui, -apple-system, Arial; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
      label { display:block; margin-top:1rem; font-weight:600 }
      input, textarea { width:100%; padding:.5rem; margin-top:.25rem }
      button { margin-top:1rem; padding:.5rem 1rem }
      img { display:block; margin-top:1rem; max-width:100%; border:1px solid #ddd }
      .output { margin-top:1rem; padding:.5rem; background:#f7f7f7; border-radius:6px }
    </style>
  </head>
  <body>
    <h1>Poster Generator â€” Test UI</h1>

    <p>Fill the form and press <strong>Generate</strong>. The page will call <code>/posters/generate</code> on <code>http://localhost:8000</code> (FastAPI default).</p>

    <form id="posterForm">
      <label>Title<input id="title" value="Sample Event" /></label>
      <label>Date & Time<input id="datetime" value="2026-01-01 18:00" /></label>
      <label>Venue<input id="venue" value="Main Hall" /></label>
      <label>Creative brief<textarea id="brief">A modern, colorful, minimal poster</textarea></label>
      <button type="submit">Generate</button>
    </form>

    <div class="output" id="outBox" style="display:none">
      <div id="message"></div>
      <div id="resultUrl"></div>
      <img id="posterImage" src="" alt="Generated poster" style="display:none"/>
    </div>

    <script>
      const form = document.getElementById('posterForm')
      const outBox = document.getElementById('outBox')
      const message = document.getElementById('message')
      const resultUrl = document.getElementById('resultUrl')
      const posterImage = document.getElementById('posterImage')

      form.addEventListener('submit', async (ev) => {
        ev.preventDefault()
        message.textContent = 'Generating...'
        outBox.style.display = 'block'
        posterImage.style.display = 'none'

        const payload = {
          event_details: {
            title: document.getElementById('title').value,
            datetime: document.getElementById('datetime').value,
            venue: document.getElementById('venue').value,
          },
          creative_brief: document.getElementById('brief').value
        }

        try {
          const res = await fetch('/posters/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          })

          const data = await res.json()
          if (!res.ok) throw new Error(data.detail || JSON.stringify(data))

          message.textContent = data.message || 'Done'
          resultUrl.innerHTML = '<strong>Poster URL:</strong> ' + (data.url || data.path)

          if (data.url) {
            posterImage.src = data.url
            posterImage.style.display = 'block'
          }
        } catch (err) {
          message.textContent = 'Error: ' + (err.message || err)
        }
      })
    </script>
  </body>
</html>